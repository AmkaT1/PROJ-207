<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <%- include('header') %>
    <div class="container">
      <h1>User's Profile</h1>

      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">User Information</h5>
          <p class="card-text">
            <strong>Customer ID:</strong> <%= userProfile.CustomerId %>
          </p>
          <p class="card-text">
            <strong>First Name:</strong> <%= userProfile.CustFirstName %>
          </p>
          <p class="card-text">
            <strong>Last Name:</strong> <%= userProfile.CustLastName %>
          </p>
          <p class="card-text">
            <strong>Address:</strong> <%= userProfile.CustAddress %>
          </p>
          <p class="card-text">
            <strong>City:</strong> <%= userProfile.CustCity %>
          </p>
          <p class="card-text">
            <strong>Province:</strong> <%= userProfile.CustProv %>
          </p>
          <p class="card-text">
            <strong>Postal Code:</strong> <%= userProfile.CustPostal %>
          </p>
          <p class="card-text">
            <strong>Country:</strong> <%= userProfile.CustCountry %>
          </p>
          <p class="card-text">
            <strong>Home Phone:</strong> <%= userProfile.CustHomePhone %>
          </p>
          <p class="card-text">
            <strong>Business Phone:</strong> <%= userProfile.CustBusPhone %>
          </p>
          <p class="card-text">
            <strong>Email Address:</strong> <%= userProfile.CustEmail %>
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Booking History</h5>
          <ul class="list-group" id="booking-history">
            <% bookings.forEach((booking) => { %>
            <li class="list-group-item">
              <strong>Booking ID:</strong> <%= booking.BookingId %>
              <br />
              <strong>Booking Number:</strong> <%= booking.BookingNo %>
              <br />
              <strong>Booking Date:</strong> <%= booking.BookingDate %>
              <br />
              <strong>Traveler Count:</strong> <%= booking.TravelerCount %>
              <br />

              <button
                class="btn btn-primary"
                onclick="toggleDetails('<%= booking.BookingId %>')"
              >
                Booking Details
              </button>
              <div id="details-<%= booking.BookingId %>" style="display: none">
                <!-- Detailed information will be loaded here -->
              </div>
            </li>
            <% }) %>
          </ul>
        </div>
      </div>
    </div>
    <%- include('footer') %>
    <script>
      function toggleDetails(id) {
        var x = document.getElementById("details-" + id);
        if (x.style.display === "none") {
          x.style.display = "block";
          fetchDetails(id); // Fetch the booking details when the div is shown
        } else {
          x.style.display = "none";
        }
      }

      function fetchDetails(id) {
        fetch("/booking-details/" + id)
          .then((response) => response.text())
          .then((data) => {
            var detailsDiv = document.getElementById("details-" + id);
            detailsDiv.innerHTML = data;
          });
      }
    </script>
  </body>
</html>
